
# LINE x Gemini x Google Calendar - Booking System

‡∏£‡∏∞‡∏ö‡∏ö Chatbot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÉ‡∏ä‡πâ Gemini AI ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Calendar + MongoDB (‡πÅ‡∏•‡∏∞ Redis ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Session)

---

##  Features
- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Calendar ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏£‡∏¥‡∏á
- ‡πÉ‡∏ä‡πâ Gemini AI Function Calling ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡πÉ‡∏ô MongoDB (`collection: booking`)
- ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô Calendar ‡πÅ‡∏•‡∏∞ Database
- ‡πÉ‡∏ä‡πâ Redis ‡πÄ‡∏Å‡πá‡∏ö session ‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ (multi-turn conversation)
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
- ‡∏™‡πà‡∏á Flex Message ‡∏™‡∏£‡∏∏‡∏õ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢

---

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô

### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡πÉ‡∏ô Google Cloud Console

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà [Google Cloud Console](https://console.cloud.google.com/)
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Project ‡πÉ‡∏´‡∏°‡πà
3. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ API
   - Google Calendar API (`calendar-json.googleapis.com`)
4. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ OAuth Consent Screen
   - Scopes: `https://www.googleapis.com/auth/calendar`
5. ‡∏™‡∏£‡πâ‡∏≤‡∏á OAuth 2.0 Client ID
   - Application Type: Web App
   - ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Authorized redirect URIs ‡πÄ‡∏ä‡πà‡∏ô `http://localhost:5001/line-chatbot-workshop/asia-northeast1/api/gemini/oauth2callback`

6. Copy ‡∏Ñ‡πà‡∏≤
   - `GOOGLE_CLIENT_ID`
   - `GOOGLE_CLIENT_SECRET`

---

### 2. ‡∏î‡∏∂‡∏á Refresh Token

1. ‡∏£‡∏±‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
2. ‡πÄ‡∏Ç‡πâ‡∏≤ URL: `http://localhost:5001/line-chatbot-workshop/asia-northeast1/api/gemini/auth`
3. Login Google, Accept
4. ‡∏î‡∏π Refresh Token ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
5. ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `.env`

---

### 3. ‡πÄ‡∏û‡∏¥‡πà‡∏° .env

```dotenv

GOOGLE_CLIENT_ID=xxx
GOOGLE_CLIENT_SECRET=xxx
GOOGLE_REDIRECT_URI=http://localhost:5001/line-chatbot-workshop/asia-northeast1/api/gemini/oauth2callback
GOOGLE_REFRESH_TOKEN=xxx

```

---

## üß† Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

### 1. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏° "‡∏à‡∏≠‡∏á‡∏ô‡∏±‡∏î"
- ‡∏û‡∏¥‡∏°‡∏û‡πå "‡∏à‡∏≠‡∏á‡∏ô‡∏±‡∏î" ‡πÉ‡∏ô LINE
- Bot ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡∏≤‡∏°‡∏ß‡∏±‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤ ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà
- (‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Redis session)

### 2. ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
- Bot ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ñ‡∏≤‡∏° "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏´‡∏°?"
- ‡∏ñ‡πâ‡∏≤ "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô" ‚Üí ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Gemini ‚Üí Function Calling ‚Üí Create Google Calendar Event + Save MongoDB

### 3. ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î
- User ‡∏û‡∏¥‡∏°‡∏û‡πå "‡∏î‡∏π‡∏ô‡∏±‡∏î"
- Bot ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏à‡∏≤‡∏Å MongoDB
- ‡∏ï‡∏≠‡∏ö Flex Message ‡πÅ‡∏™‡∏î‡∏á‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### 4. ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ô‡∏±‡∏î
- User ‡∏Å‡∏î "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ô‡∏±‡∏î"
- Bot ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô MongoDB ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏ô‡∏±‡∏î‡πÉ‡∏ô Google Calendar
- ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß

---

## üì¢ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
- Session timeout 5 ‡∏ô‡∏≤‡∏ó‡∏µ (Redis)
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πá‡∏ö‡∏•‡∏á MongoDB ‡∏û‡∏£‡πâ‡∏≠‡∏° eventId ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á

---
